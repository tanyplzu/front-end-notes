(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{518:function(t,a,s){"use strict";s.r(a);var n=s(6),r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react-性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-性能优化"}},[t._v("#")]),t._v(" React 性能优化")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#问题"}},[t._v("问题")])]),a("li",[a("a",{attrs:{href:"#衡量工具"}},[t._v("衡量工具")]),a("ul",[a("li",[a("a",{attrs:{href:"#lighthouse"}},[t._v("Lighthouse")])]),a("li",[a("a",{attrs:{href:"#apm-工具"}},[t._v("APM 工具")])])])]),a("li",[a("a",{attrs:{href:"#指标采集工作"}},[t._v("指标采集工作")]),a("ul",[a("li",[a("a",{attrs:{href:"#fcp-first-contentful-paint"}},[t._v("FCP（First Contentful Paint）")])]),a("li",[a("a",{attrs:{href:"#fp、fpt、fmp"}},[t._v("FP、FPT、FMP")])]),a("li",[a("a",{attrs:{href:"#tti-time-to-interact"}},[t._v("TTI（Time to Interact）")])]),a("li",[a("a",{attrs:{href:"#page-load"}},[t._v("Page Load")])]),a("li",[a("a",{attrs:{href:"#fps"}},[t._v("FPS")])]),a("li",[a("a",{attrs:{href:"#静态资源及-api-请求成功率"}},[t._v("静态资源及 API 请求成功率")])])])]),a("li",[a("a",{attrs:{href:"#优化时机"}},[t._v("优化时机")])]),a("li",[a("a",{attrs:{href:"#工具"}},[t._v("工具")])]),a("li",[a("a",{attrs:{href:"#常见的坑"}},[t._v("常见的坑")])]),a("li",[a("a",{attrs:{href:"#处理方案"}},[t._v("处理方案")])]),a("li",[a("a",{attrs:{href:"#提升-react-代码可维护性"}},[t._v("提升 React 代码可维护性")]),a("ul",[a("li",[a("a",{attrs:{href:"#预防"}},[t._v("预防")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),a("ul",[a("li",[t._v("如何分析和调优性能瓶颈？")]),t._v(" "),a("li",[t._v("如何避免重复渲染？")]),t._v(" "),a("li",[t._v("如何提升 React 代码可维护性？")])]),t._v(" "),a("h2",{attrs:{id:"衡量工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#衡量工具"}},[t._v("#")]),t._v(" 衡量工具")]),t._v(" "),a("h3",{attrs:{id:"lighthouse"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lighthouse"}},[t._v("#")]),t._v(" Lighthouse")]),t._v(" "),a("ul",[a("li",[t._v("Lighthouse 并不能真实地反映出每个用户的设备的实际性能数据；")]),t._v(" "),a("li",[t._v("Lighthouse 的分数反应的是业界的标准，而非项目实际需求的标准。")])]),t._v(" "),a("h3",{attrs:{id:"apm-工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apm-工具"}},[t._v("#")]),t._v(" APM 工具")]),t._v(" "),a("ul",[a("li",[t._v("国际上比较老牌的就是 New Relic，实力十分强悍；")]),t._v(" "),a("li",[t._v("国内的话可以直接考虑使用阿里云的 ARMS，")]),t._v(" "),a("li",[t._v("开源项目自建。")])]),t._v(" "),a("h2",{attrs:{id:"指标采集工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指标采集工作"}},[t._v("#")]),t._v(" 指标采集工作")]),t._v(" "),a("h3",{attrs:{id:"fcp-first-contentful-paint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fcp-first-contentful-paint"}},[t._v("#")]),t._v(" FCP（First Contentful Paint）")]),t._v(" "),a("p",[a("strong",[t._v("首次绘制内容的耗时")])]),t._v(" "),a("p",[t._v("首屏统计的方式一直在变，起初是通过记录 window.performance.timing 中的 domComplete 与 domLoading 的时间差来完成，但这并不具备交互意义，现在通常是记录初次加载并绘制内容的时间。")]),t._v(" "),a("p",[t._v("回到 React 的角度来看，加载一个 React 页面，通常是从白屏到直接显示内容。那么如果白屏时间很长，用户可能会流失，就需要在页面上绘制内容，给出一些反馈。")]),t._v(" "),a("p",[t._v("最早的优化方案是绘制一个 Loading 图标，写死在 HTML 的 CSS 里，等 JS 开始执行的时候再移除它。")]),t._v(" "),a("p",[t._v("还有一种解决方案是 SSR，也就是走服务端渲染路线，常用的方案有 next.js 等。")]),t._v(" "),a("p",[t._v("TP99 指标：")]),t._v(" "),a("ul",[a("li",[t._v("一般 50 ~ 60 FPS，就相当流畅了；")]),t._v(" "),a("li",[t._v("在 30 ~ 50 FPS 之间就因人而异了，通常属于尚可接受的范畴；")]),t._v(" "),a("li",[t._v("在 30 FPS 以下属于有明显卡顿，会令人不适。")])]),t._v(" "),a("h3",{attrs:{id:"fp、fpt、fmp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fp、fpt、fmp"}},[t._v("#")]),t._v(" FP、FPT、FMP")]),t._v(" "),a("p",[t._v("浏览器从开始请求网站开始计算。")]),t._v(" "),a("ul",[a("li",[t._v("FP：渲染出第一个像素点；")]),t._v(" "),a("li",[t._v("FPT: 渲染第一个内容，不包括白色背景和 Canvas 元素；")]),t._v(" "),a("li",[t._v("FMP：渲染出第一个关键内容。每个网站的关键内容不一样，导致计算比较复杂，也不准确。")])]),t._v(" "),a("h3",{attrs:{id:"tti-time-to-interact"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tti-time-to-interact"}},[t._v("#")]),t._v(" TTI（Time to Interact）")]),t._v(" "),a("p",[a("strong",[t._v("是页面可交互的时间")])]),t._v(" "),a("p",[t._v("通常通过记录 window.performance.timing 中的 domInteractive 与 fetchStart 的时间差来完成。")]),t._v(" "),a("p",[t._v("TTI 在实现上，可以优先加载让用户关注的内容，让用户先用起来。策略上主要是将异步加载与懒加载相结合。")]),t._v(" "),a("h3",{attrs:{id:"page-load"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page-load"}},[t._v("#")]),t._v(" Page Load")]),t._v(" "),a("p",[a("strong",[t._v("页面完全加载时间")])]),t._v(" "),a("p",[t._v("通常通过记录 window.performance.timing 中的 loadEventStart 与 fetchStart 的时间差来完成。")]),t._v(" "),a("p",[t._v("异步加载主要由 Webpack 打包 common chunk 与异步组件的方式完成。")]),t._v(" "),a("h3",{attrs:{id:"fps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fps"}},[t._v("#")]),t._v(" FPS")]),t._v(" "),a("p",[a("strong",[t._v("前端页面帧率")])]),t._v(" "),a("p",[t._v("通常是在主线程打点完成记录。其原理是 requestAnimationFrame 会在页面重绘前被调用，而 FPS 就是计算两次之间的时间差。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastFameTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("loop")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  lastFameTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  frame"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lastTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("round")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("now "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" lastTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    lastTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" now"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("在 React 中引起卡顿的主要原因有长列表与重渲染。长列表的解决方案很成熟，直接使用 react-virtualized 或者 react-window 就可以，相关的原理你可以自行学习；重渲染的问题比较复杂，下一讲我会详细讲解。")]),t._v(" "),a("h3",{attrs:{id:"静态资源及-api-请求成功率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源及-api-请求成功率"}},[t._v("#")]),t._v(" 静态资源及 API 请求成功率")]),t._v(" "),a("p",[t._v("通常是通过 window.performance.getEntries( ) 来获取相关信息。")]),t._v(" "),a("h2",{attrs:{id:"优化时机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化时机"}},[t._v("#")]),t._v(" 优化时机")]),t._v(" "),a("h2",{attrs:{id:"工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具"}},[t._v("#")]),t._v(" 工具")]),t._v(" "),a("p",[t._v("React Profiler：颜色和高度对应该次提交渲染所需的时间。")]),t._v(" "),a("p",[t._v("从概念上讲，React 分两个阶段工作：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("渲染")]),t._v(" 阶段会确定需要进行哪些更改，比如 DOM。在此阶段，React 调用 render，然后将结果与上次渲染的结果进行比较。")]),t._v(" "),a("li",[a("strong",[t._v("提交")]),t._v(" 阶段发生在当 React 应用变化时。（对于 React DOM 来说，会发生在 React 插入，更新及删除 DOM 节点的时候。）在此阶段，React 还会调用 componentDidMount 和 componentDidUpdate 之类的生命周期方法。")])]),t._v(" "),a("p",[t._v("开发者工具的 profiler 是在提交阶段收集性能数据的。")]),t._v(" "),a("p",[t._v("profiler 提供了一个筛选功能。")]),t._v(" "),a("h2",{attrs:{id:"常见的坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的坑"}},[t._v("#")]),t._v(" 常见的坑")]),t._v(" "),a("p",[t._v("参数动态化。")]),t._v(" "),a("p",[t._v("React.memo 还是 PureComponent 都是通过浅比较的方式对比变化前后的 props 与 state。但这个两个方法往往会失效。")]),t._v(" "),a("ul",[a("li",[t._v("最常见的情况使用了箭头函数")])]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListItem")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("text")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onMoveUp")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//... }}")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onMoveDown")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handleMoveDown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),a("p",[t._v("这是因为箭头函数在 List 每次调用 render 时都会动态生成一个新的函数，函数的引用变化了，这时即便使用 React.memo 也是无效的。")]),t._v(" "),a("p",[t._v("如果长列表中使用箭头函数，对性能影响很大。")]),t._v(" "),a("p",[t._v("如果 props 中传入一个普通的方法，也会造成重新渲染。可以使用 useCallback 包裹。")]),t._v(" "),a("h2",{attrs:{id:"处理方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理方案"}},[t._v("#")]),t._v(" 处理方案")]),t._v(" "),a("ol",[a("li",[t._v("性能不够，缓存来凑，第一类方案是添加缓存来处理，常见的解决方案有 Facebook 自研的 reselect。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createSelector "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'reselect'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("listSelector")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataSelector "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  listSelector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("list")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*... */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("FlatList\n      data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dataSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      renderItem"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("renderItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("2.不可变数据")]),t._v(" "),a("p",[t._v("ImmutableJS")]),t._v(" "),a("p",[t._v("3.手动控制")]),t._v(" "),a("p",[t._v("使用 shouldComponentUpdate 可能会带来意想不到的 Bug，所以这个方案应该放到最后考虑。")]),t._v(" "),a("h2",{attrs:{id:"提升-react-代码可维护性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提升-react-代码可维护性"}},[t._v("#")]),t._v(" 提升 React 代码可维护性")]),t._v(" "),a("h3",{attrs:{id:"预防"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预防"}},[t._v("#")]),t._v(" 预防")]),t._v(" "),a("ul",[a("li",[t._v("人工审查代码的方式， Code Review。")]),t._v(" "),a("li",[t._v("工具审查的方式，标准称谓是静态代码检查工具。在 JavaScript 世界中，静态代码检查工具 ESLint。")])]),t._v(" "),a("p",[t._v("在前端工程中最常见的 Lint 工具包含：")]),t._v(" "),a("ul",[a("li",[t._v("针对 JavaScript 的 ESLint；")]),t._v(" "),a("li",[t._v("针对样式的 Stylelint；")]),t._v(" "),a("li",[t._v("针对代码提交的 Commitlint；")]),t._v(" "),a("li",[t._v("针对编辑器风格的 Editorconfig；")]),t._v(" "),a("li",[t._v("针对代码风格的 Prettier。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);